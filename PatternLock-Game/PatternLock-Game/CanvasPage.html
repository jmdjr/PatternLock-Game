<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Pattern Lock Game V 2.0</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://sugarjs.com/release/current/sugar.min.js"></script>
    <script src="Script/phaser.js"></script>
    <script src="Script/jquerymy-1.1.4.js"></script>
</head>
<body>
    <script>
        var game = new Phaser.Game(308, 492, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        function preload() {
            DeviceScreenManager.preload(game);
            GameButtonFactory.preload(game);
            TouchScreenDisplays.preload(game);
        }

        function create() {
            DeviceScreenManager.create(game);

        }

        function update() {
        }

        //*******************************************************************************************************************************************************
        //                   Game Resources - Buttons: Manager for all button related activities.
        //*******************************************************************************************************************************************************
        var GameButtonFactory = {
            info: {
                key: 'buttons',
                src: 'Resources/ButtonsSpriteSheet.png',
                height: 34,
                width: 34
            },

            buttonState: { 
                Idle: 0,
                Active: 1
            },

            overlayState: {
                Correct: 2,
                Wrong: 3,
                Over: 4,
                Close: 5,
                Under: 6
            },

            preload: function (game) {
                game.load.spritesheet(this.info.key, this.info.src, this.info.height, this.info.width, 7);
            },

            button: function (game, x, y, xpad, ypad) {
                Phaser.Sprite.call(this, game, x * (GameButtonFactory.info.width + xpad), y * (GameButtonFactory.info.height + ypad), GameButtonFactory.info.key, GameButtonFactory.buttonState.Idle);
                this._active = false;
                this._pos = { x: x, y: y };
            }
        }

        var p = GameButtonFactory.button.prototype = Object.create(Phaser.Sprite.prototype);
        GameButtonFactory.button.prototype.constructor = GameButtonFactory.button;
        
        p.activate = function () {
            this.frame = GameButtonFactory.buttonState.Active;
            this._active = true;
        }

        p.deactivate = function () {
            this.frame = GameButtonFactory.buttonState.Idle;
            this._active = false;
        }

        p.update = function () {

        }

        //*******************************************************************************************************************************************************
        //                   Game Resources - DeviceScreenManager
        //*******************************************************************************************************************************************************
        // The Device Screen Manager deals with rendering the main game display, such as the border box, and acts as the device, loading Touch Screen Displays
        // into the device layers.
        var DeviceScreenManager = {
            info: {
                screenFrame: {
                    ref: null,
                    key: 'frame',
                    src: 'Resources/cellphone.png',
                },
                
                height: 492,
                width: 308,
                top: 69,
                left: 27,
                bottom: 393,
                right: 283
            },

            _background: null,
            _midground: null,
            _forground: null,

            preload: function (game) {
                game.load.image(this.info.screenFrame.key, this.info.screenFrame.src);
            },

            create: function (game) {
                this._background = game.add.group();
                this._midground = game.add.group();
                this._forground = game.add.group();

                this._drawBaseGraphics(game);

                TouchScreenDisplays.create(game);
                this._midground.add(TouchScreenDisplays.getFrame());
            }, 

            _drawBaseGraphics: function (game) {
                this.info.screenFrame.ref = game.add.sprite(0, 0, this.info.screenFrame.key, this.info.screenFrame.src);
                this._forground.add(this.info.screenFrame.ref);
            },

            update: function () {
                
            }
        }
        //*******************************************************************************************************************************************************
        //                   Game Manager - Touch Screens
        //*******************************************************************************************************************************************************

        //var tempalteDisplay = {
        //    preload: function (game) { },
        //    create: function (game) { },
        //    getDisplay: function (game) { }
        //}

        //     Game Resource - Screen displays
        //-------------------------------------------------------------------------------------------------------------------------------------------------------
        var gameScreenDisplay = {
            info: {
                top: 69,
                left: 27,
            },

            screenBackground: {
                ref: null,
                key: 'screenBackground',
                src: 'Resources/background_1.png'
            },

            textGraphic: {
                key: 'swipeText',
                src: 'Resources/phoneText.png',
                scale: new Phaser.Point(0.75, 0.75),
                ref: null
            },

            lockPatterns: {
                small3x3: {
                    v: 3,
                    h: 3,
                    vpad: 20,
                    hpad: 20,
                    top: 130,
                    left: 66,
                    textX: 65,
                    textY: 100
                },
                medium4x4: {
                    v: 4,
                    h: 4,
                    vpad: 10,
                    hpad: 10,
                    top: 131,
                    left: 43,
                    textX: 65,
                    textY: 100
                },
                odd5x3: {
                    v: 5,
                    h: 3,
                    vpad: 10,
                    hpad: 10,
                    top: 96,
                    left: 68,
                    textX: 65,
                    textY: 100
                }
            },

            _lockButtons: null,
            _lockPattern: null,

            preload: function (game) {
                game.load.image(this.screenBackground.key, this.screenBackground.src);
                game.load.image(this.textGraphic.key, this.textGraphic.src);
            },

            create: function (game) {
                this._lockPattern = this.lockPatterns.small3x3;
                this._lockButtons = game.add.group();
                this._createLockButtons(game);

                this.screenBackground.ref = game.add.sprite(this.info.left, this.info.top, this.screenBackground.key, this.screenBackground.src);
                this.textGraphic.ref = game.add.sprite(this._lockPattern.textX, this._lockPattern.textY, this.textGraphic.key);
                this.textGraphic.ref.scale = this.textGraphic.scale;

                this._lockButtons.x = this.info.left + this._lockPattern.left;
                this._lockButtons.y = this.info.top + this._lockPattern.top;
            },
            
            // returns the assets which belong in the foreground
            getDisplay: function(game) {
                var display = game.add.group();
                display.add(this.screenBackground.ref);
                display.add(this.textGraphic.ref);
                display.add(this._lockButtons);
                return display;
            },

            update: function () {

            },

            _createLockButtons: function (game) {
                if (this._lockPattern == null) {
                    return null;
                }

                var vp = this._lockPattern.vpad || 0;
                var hp = this._lockPattern.hpad || 0;

                for (var i = 0; i < this._lockPattern.v; ++i) {
                    for (var j = 0; j < this._lockPattern.h; ++j) {
                        var button = new GameButtonFactory.button(game, j, i, vp, hp);

                        //if (((i * w) + j) % 2 == 0) {
                        //    button.changeState(GameButtonFactory.buttonState.Active);
                        //}

                        this._lockButtons.add(button);
                    }
                }

                this._lockButtons.setAll('inputEnabled', true);
                this._lockButtons.callAll('events.onInputDown.add', 'events.onInputDown', gameScreenDisplay._buttonClicked);
            },

            _buttonClicked: function (item) {
                if (item._active) {
                    item.deactivate();
                }
                else {
                    item.activate();
                }
            }
        }

        //-------------------------------------------------------------------------------------------------------------------------------------------------------

        var titleScreenDisplay = {
            preload: function (game) {

            },

            create: function (game) {

            },

            getDisplay: function (game) {

            }
        }

        //-------------------------------------------------------------------------------------------------------------------------------------------------------
        //-------------------------------------------------------------------------------------------------------------------------------------------------------

        var TouchScreenDisplays = {

            // more scenes here for title screen, pause etc...
            screenDisplays: [gameScreenDisplay],

            _dirtyDisplay: true,

            _CurrentDisplay: null,

            _frame: null,

            preload: function (game) {
                var i = 0;
                while (i < this.screenDisplays.length) {
                    this.screenDisplays[i].preload(game);
                    ++i;
                }
            },

            create: function (game) {
                this._CurrentDisplay = this.screenDisplays[0];
                this._CurrentDisplay.create(game);

                this._frame = game.add.group();
                this.setupGraphics(game);
            },

            setupGraphics: function (game) {
                this._frame.removeAll();
                this._frame.add(this._CurrentDisplay.getDisplay(game));
            },

            getFrame: function() {
                return this._frame;
            },

            getRefresh: function () {
                return this._dirtyDisplay;
            },

            update: function (game) {
                if (this._dirtyDisplay) {
                    this.setupGraphics(game);
                }
            }
        }

        //*******************************************************************************************************************************************************
        //                   Game Resources - Debug Control
        //*******************************************************************************************************************************************************
        //var DebugControlScreenManager = {
        //    info: {
        //        debugContent: 'debug-controls'
        //    },

        //    create: function () {
        //        $('body').append('<div class="debug-controls"></div>');
        //    },

        //    setupControls: function (object, params) {
        //        if (params && params.length > 0) {
        //            $('.' + this.info.debugContent).empty();
        //            var ui = {};
        //            for (var i = 0; i < params.length; ++i) {
        //                if(params[i] && typeof(params[i]) == 'string' && object[params[i]])
        //                {
        //                    $('.' + this.info.debugContent).append('<input type="number" title="' + params[i] + '" value="' + object[params[i]] + '" id="' + params[i] + '"  /><br/>');
        //                    ui["#" + params[i]] = params[i];
        //                }
        //            }
        //            debugger;
        //            //$('.' + this.info.debugContent).my({ ui: ui }, object);
        //        }
        //    }
        //}


    </script>
</body>
</html>
