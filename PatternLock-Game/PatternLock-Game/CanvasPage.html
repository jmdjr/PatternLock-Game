<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Pattern Lock Game V 2.0</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://sugarjs.com/release/current/sugar.min.js"></script>
    <script src="Script/phaser.js"></script>
    <script src="Script/jquerymy-1.1.4.js"></script>
</head>
<body>
    <script>
        var game = new Phaser.Game(308, 492, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        function preload() {
            ButtonScreenManager.preload(game);
            GameButtonManager.preload(game);
        }

        function create() {
            ButtonScreenManager.create(game);
        }

        function update() {
        }



        //*******************************************************************************************************************************************************
        //                   Game Resources - Buttons: Manager for all button related activities.
        //*******************************************************************************************************************************************************
        var GameButtonManager = {
            info: {
                key: 'buttons',
                src: 'Resources/ButtonsSpriteSheet.png',
                height: 34,
                width: 34
            },

            buttonState: { 
                Idle: 0,
                Active: 1
            },

            overlayState: {
                Correct: 2,
                Wrong: 3,
                Over: 4,
                Close: 5,
                Under: 6
            },

            preload: function (game) {
                game.load.spritesheet(this.info.key, this.info.src, this.info.height, this.info.width, 7);
            },

            button: function (game, x, y, xpad, ypad) {
                Phaser.Sprite.call(this, game, x * (GameButtonManager.info.width + xpad), y * (GameButtonManager.info.height + ypad), GameButtonManager.info.key, GameButtonManager.buttonState.Idle);
                this._active = false;
                this._pos = { x: x, y: y };
            }
        }

        var p = GameButtonManager.button.prototype = Object.create(Phaser.Sprite.prototype);
        GameButtonManager.button.prototype.constructor = GameButtonManager.button;
        
        p.activate = function () {
            this.frame = GameButtonManager.buttonState.Active;
            this._active = true;
        }

        p.deactivate = function () {
            this.frame = GameButtonManager.buttonState.Idle;
            this._active = false;
        }

        p.update = function () {

        }

        //*******************************************************************************************************************************************************
        //                   Game Resources - ButtonScreenManager
        //*******************************************************************************************************************************************************

        var ButtonScreenManager = {
            info: {
                screenFrame: {
                    ref: null,
                    key: 'frame',
                    src: 'Resources/cellphone.png',
                },
                screenBackground: {
                    ref: null,
                    key: 'screenBackground',
                    src: 'Resources/background_1.png'
                },
                
                height: 492,
                width: 308,
                top: 69,
                left: 27,
                bottom: 393,
                right: 283
            },
            textGraphic: {
                key: 'swipeText',
                src: 'Resources/phoneText.png',
                scale: new Phaser.Point(0.75, 0.75),
                ref: null
            },
            
            lockPatterns: {
                small3x3: {
                    v: 3,
                    h: 3,
                    vpad: 10,
                    hpad: 10,
                    top: 166,
                    left: 66,
                    textX: 65,
                    textY: 100
                },
                medium4x4: {
                    v: 4,
                    h: 4,
                    vpad: 10,
                    hpad: 10,
                    top: 131,
                    left: 43,
                    textX: 65,
                    textY: 100
                },
                odd5x3: {
                    v: 5,
                    h: 3,
                    vpad: 10,
                    hpad: 10,
                    top: 96,
                    left: 68,
                    textX: 65,
                    textY: 100
                }
            },
            
            _background: null,
            _midground: null,
            _forground: null,

            _lockButtons: null,
            _lockPattern: null,

            preload: function (game) {
                game.load.image(this.info.screenBackground.key, this.info.screenBackground.src);
                game.load.image(this.info.screenFrame.key, this.info.screenFrame.src);
                game.load.image(this.textGraphic.key, this.textGraphic.src);
            },

            create: function (game) {

                this._lockPattern = this.lockPatterns.small3x3;

                this._drawBaseGraphics();

                this._createLockButtons(game);
            }, 

            _drawBaseGraphics: function () {

                this._background = game.add.group();
                this._midground = game.add.group();
                this._forground = game.add.group();

                this.info.screenBackground.ref = game.add.sprite(this.info.left, this.info.top, this.info.screenBackground.key, this.info.screenBackground.src);
                this.textGraphic.ref = game.add.sprite(this._lockPattern.textX, this._lockPattern.textY, this.textGraphic.key);
                this.textGraphic.ref.scale = this.textGraphic.scale;
                this.info.screenFrame.ref = game.add.sprite(0, 0, this.info.screenFrame.key, this.info.screenFrame.src);

                this._background.add(this.info.screenBackground.ref);
                this._midground.add(this.textGraphic.ref);
                this._forground.add(this.info.screenFrame.ref);

                this._lockButtons = game.add.group();

                this._lockButtons.x = this.info.left + this._lockPattern.left;
                this._lockButtons.y = this.info.top + this._lockPattern.top;

                this._midground.add(this._lockButtons);
            },

            _createLockButtons: function (game) {
                if (this._lockPattern == null) {
                    return null;
                }

                var vp = this._lockPattern.vpad || 0;
                var hp = this._lockPattern.hpad || 0;

                for (var i = 0; i < this._lockPattern.v; ++i) {
                    for (var j = 0; j < this._lockPattern.h; ++j) {
                        var button = new GameButtonManager.button(game, j, i, vp, hp);

                        //if (((i * w) + j) % 2 == 0) {
                        //    button.changeState(GameButtonManager.buttonState.Active);
                        //}

                        this._lockButtons.add(button);
                    }
                }

                this._lockButtons.setAll('inputEnabled', true);
                this._lockButtons.callAll('events.onInputDown.add', 'events.onInputDown', ButtonScreenManager._buttonClicked);
            },

            _buttonClicked: function (item) {
                if (item._active) {
                    item.deactivate();
                }
                else {
                    item.activate();
                }
            }
        }

        ////*******************************************************************************************************************************************************
        ////                   Game Resources - Debug Control
        ////*******************************************************************************************************************************************************
        //var DebugControlScreenManager = {
        //    info: {
        //        debugContent: 'debug-controls'
        //    },

        //    create: function () {
        //        $('body').append('<div class="debug-controls"></div>');
        //    },

        //    setupControls: function (object, params) {
        //        if (params && params.length > 0) {
        //            $('.' + this.info.debugContent).empty();
        //            var ui = {};
        //            for (var i = 0; i < params.length; ++i) {
        //                if(params[i] && typeof(params[i]) == 'string' && object[params[i]])
        //                {
        //                    $('.' + this.info.debugContent).append('<input type="number" title="' + params[i] + '" value="' + object[params[i]] + '" id="' + params[i] + '"  /><br/>');
        //                    ui["#" + params[i]] = params[i];
        //                }
        //            }
        //            debugger;
        //            //$('.' + this.info.debugContent).my({ ui: ui }, object);
        //        }
        //    }
        //}


    </script>
</body>
</html>
